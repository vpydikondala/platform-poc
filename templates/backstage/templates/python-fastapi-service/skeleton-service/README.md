# {{ name }}

This repository was generated by **Backstage** using the platform "Golden Path"
for Python FastAPI services deployed to AKS using **Argo CD GitOps**.

---

## What this repo contains

### Application
- `src/app/main.py` — FastAPI app
- `requirements.txt` — Python dependencies

### Container build
- `Dockerfile` — builds a container image that serves FastAPI on port 8080

### Kubernetes deployment (Helm)
- `helm/{{ name }}/` — Helm chart used by Argo CD to deploy into AKS
  - Deployment, Service, Ingress resources

### TechDocs
- `mkdocs.yml` + `docs/` — documentation published to Backstage TechDocs

### CI/CD (GitHub Actions)
- `.github/workflows/build.yml` — build + push image to ACR on each merge to main
- `.github/workflows/techdocs.yml` — publish documentation
- `.github/workflows/promote.yml` — update env-gitops and open PR to deploy a chosen image tag

---

## Runtime model (how deployment works)

This repo does **not** deploy to AKS directly.

Instead:
1) CI builds image → pushes to **ACR** using SHA tag (example: `abc1234`)
2) Deployment happens via **env-gitops**
   - `env-gitops/apps/dev/{{ name }}/values.yaml` decides what image tag is deployed to dev
   - Argo CD watches env-gitops and reconciles AKS accordingly

---

## Endpoints

- `GET /` — service info
- `GET /healthz` — health check used by Kubernetes probes

---

## How to deploy a new version

1) Merge to `main`
2) Note the image tag (first 7 chars of commit SHA)
3) Run **Promote (GitOps)** workflow:
   - environment: `dev` or `prod`
   - image_tag: `abc1234`
4) Merge the generated PR in env-gitops
5) Argo CD syncs and updates AKS automatically

---

## Ingress hostname

All services share the same ingress public IP (the ingress-nginx LoadBalancer).
Each service uses a unique host name, for example:

- Dev: `{{ name }}.<INGRESS_IP>.sslip.io`
- Prod: `{{ name }}-prod.<INGRESS_IP>.sslip.io`

NGINX routes based on hostname.
